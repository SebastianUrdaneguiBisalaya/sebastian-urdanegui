---
import Layout from "@layouts/Layout.astro";
import { getEntry, render } from "astro:content";

interface Comment {
  id: string;
  user_name?: string;
  comment: string;
}

const { id } = Astro.params;

console.log("id", id);

if (!id) {
  return Astro.redirect("/404");
}

const entry = await getEntry("englishBlog", id);

if (!entry) {
  return Astro.redirect("/404");
}

const { Content } = await render(entry);
---

<Layout id={id}>
  <article id={id} class="w-full flex flex-col gap-4">
    <div class="flex flex-row items-center justify-between w-full gap-4">
      <p class="font-reddit text-dark/60 dark:text-gray-300 text-xs w-full">
        {`Update date: ${entry.data.publishDate}`}
      </p>
      <!-- <div class="flex flex-row items-center gap-4 w-fit">
        <div class="flex flex-row items-center gap-2">
          <span class="opacity-50 text-dark/60 dark:text-gray-300">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="15"
              height="15"
              viewBox="0 0 32 32"
              ><path
                fill="currentColor"
                d="M30.94 15.66A16.69 16.69 0 0 0 16 5A16.69 16.69 0 0 0 1.06 15.66a1 1 0 0 0 0 .68A16.69 16.69 0 0 0 16 27a16.69 16.69 0 0 0 14.94-10.66a1 1 0 0 0 0-.68M16 25c-5.3 0-10.9-3.93-12.93-9C5.1 10.93 10.7 7 16 7s10.9 3.93 12.93 9C26.9 21.07 21.3 25 16 25"
              ></path><path
                fill="currentColor"
                d="M16 10a6 6 0 1 0 6 6a6 6 0 0 0-6-6m0 10a4 4 0 1 1 4-4a4 4 0 0 1-4 4"
              ></path></svg
            >
          </span>
          <p class="font-reddit text-dark/60 dark:text-gray-300 text-xs w-full">
            {entry.data.views}
          </p>
        </div>
        <div class="flex flex-row items-center gap-2">
          <span class="opacity-50 text-dark/60 dark:text-gray-300">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="15"
              height="15"
              viewBox="0 0 24 24"
              ><path
                fill="none"
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4.3 16.7a9 9 0 1 1 3 3L3 21z"></path></svg
            >
          </span>
          <p class="font-reddit text-dark/60 dark:text-gray-300 text-xs w-full">
            {entry.data.comments}
          </p>
        </div>
      </div> -->
    </div>
    <div class="prose dark:prose-invert max-w-full">
      <Content />
    </div>
    <div class="flex flex-col gap-4">
      <form id="comment-form" class="flex flex-col gap-2 w-full mb-4">
        <label
          class="font-sora prose dark:prose-invert text-sm w-full"
          for="user-name"
        >
          User name
        </label>
        <input
          id="user-name"
          class="w-full prose dark:prose-invert font-reddit focus:ring-0 focus:border-0 focus:outline-none border-b-[0.5px] border-gray-500"
          type="text"
          placeholder="Write your name"
        />
        <label
          class="font-sora prose dark:prose-invert text-sm w-full"
          for="comment"
        >
          Comment
        </label>
        <textarea
          class="w-full prose dark:prose-invert font-reddit focus:ring-0 focus:border-0 focus:outline-none border-b-[0.5px] border-gray-500"
          id="comment"
          placeholder="Write your comment"></textarea>
        <button
          class="w-fit bg-dark/90 dark:bg-gray-200 prose-invert dark:prose font-reddit rounded-lg py-2 px-4 hover:bg-dark/90 dark:hover:bg-gray-100 cursor-pointer"
          type="submit"
        >
          Post comment
        </button>
      </form>
      <div
        id="comment-response"
        class="my-4 p-3 text-sm text-center prose dark:prose-invert border border-gray-400 w-fit rounded-lg hidden"
      >
      </div>
    </div>
  </article>
</Layout>

<script>
  const contentId = document.getElementsByTagName("article")[0].id;
  if (contentId) {
    fetch("/api/projects", {
      method: "PATCH",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        id: contentId,
      }),
    }).catch((error) =>
      console.error("Error al actualizar la cantidad de vistas:", error)
    );
  }
</script>
